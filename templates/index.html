{% extends "base.html" %}
{% block content %}
<div class="shell">
  <header class="topbar">
    <div class="brand">Encrypted Cloud</div>
    <div class="actions">
      <button id="lock-btn" class="btn ghost" type="button">Lock</button>
    </div>
  </header>

  <main class="vault">
    <section class="panel upload">
      <h2>Upload</h2>
      <p class="sub">Drag & drop a file. It will be encrypted before storage.</p>
      <div id="drop-zone" class="drop-zone">
        <div class="drop-inner">
          <div class="drop-title">Drop files here</div>
          <div class="drop-sub">or click to browse</div>
        </div>
        <input id="file-input" type="file" />
      </div>
      <div id="upload-status" class="hint" hidden></div>
    </section>

    <section class="panel files">
      <div class="files-header">
        <h2>Your Files</h2>
        <span class="meta">{{ files|length }} files</span>
      </div>
      <div class="storage">
        <div class="storage-labels">
          <span>Storage Used</span>
          <span>{{ used_bytes|filesizeformat(binary=True) }} / {{ total_bytes|filesizeformat(binary=True) }}</span>
        </div>
        <div class="storage-track">
          <div class="storage-fill" style="width: {{ percent }}%"></div>
        </div>
      </div>
      <div class="filters">
        <div class="search">
          <input id="file-search" type="text" placeholder="Search files..." />
        </div>
        <div class="filter-group">
          <select id="date-filter">
            <option value="all">All dates</option>
            <option value="24h">Last 24h</option>
            <option value="7d">Last 7 days</option>
            <option value="30d">Last 30 days</option>
          </select>
          <select id="size-filter">
            <option value="all">All sizes</option>
            <option value="lt1">Under 1 MB</option>
            <option value="1to10">1–10 MB</option>
            <option value="10to100">10–100 MB</option>
            <option value="gt100">Over 100 MB</option>
          </select>
          <select id="sort-by">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
            <option value="largest">Largest first</option>
            <option value="smallest">Smallest first</option>
          </select>
        </div>
      </div>
      {% if files %}
      <div id="file-list" class="file-list">
        {% for f in files %}
        <div class="file-card" data-file-id="{{ f.id }}" data-file-name="{{ f.alias }}"
          data-display-name="{{ f.display_name }}" data-size="{{ f.size }}" data-uploaded="{{ f.uploaded_at }}">
          <div class="file-main">
            <div class="file-name">{{ f.display_name }}</div>
            {% if f.mime and f.mime.startswith('image/') %}
            <div class="file-preview">
              <img src="{{ url_for('view_thumbnail', file_id=f.id) }}" alt="{{ f.display_name }}" loading="lazy" />
            </div>
            {% endif %}
            <div class="file-meta">{{ f.mime }} · {{ f.size|filesizeformat(binary=True) }}</div>
            <div class="file-meta">Uploaded {{ f.uploaded_at }}</div>
          </div>
          <div class="file-actions">
            <button class="btn small rename-btn" type="button">Edit</button>
            <a class="btn small ghost" href="{{ url_for('view_file', file_id=f.id, download=1) }}">Download</a>
            <button class="btn small ghost danger delete-btn" type="button">Delete</button>
          </div>
        </div>
        {% endfor %}
      </div>
      <div id="no-results" class="empty" hidden>No files match your filters.</div>
      {% else %}
      <div class="empty">No files yet. Upload your first file above.</div>
      {% endif %}
    </section>
  </main>

  <div id="delete-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="delete-title">
      <h3 id="delete-title">Delete File</h3>
      <p id="delete-message" class="modal-text">Are you sure you want to delete this file?</p>
      <div class="modal-actions">
        <button id="cancel-delete" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-delete" class="btn danger" type="button">Delete</button>
      </div>
    </div>
  </div>
  <div id="rename-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="rename-title">
      <h3 id="rename-title">Rename File</h3>
      <div class="field">
        <label for="rename-input">New Name</label>
        <input id="rename-input" type="text" class="input" placeholder="Enter new name" />
        <p class="hint">File extension will be preserved.</p>
      </div>
      <div class="modal-actions">
        <button id="cancel-rename" class="btn ghost" type="button">Cancel</button>
        <button id="confirm-rename" class="btn primary" type="button">Save</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}